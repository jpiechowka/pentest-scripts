#!/usr/bin/env bash

display_help()
{
    echo "Zone transfer testing script for domain enumeration."
    echo "It will perform zone transfer recursively for any subdomain found."
    echo "Usage:"
    echo -e "    $0 [TARGET] [TARGET NAMESERVER]\n"
    echo "Do not forget to edit /etc/hosts if necessary."
}

if [ -z $1 ]; then
    echo -e "Error: target is empty. Pass target as first argument.\n"
    display_help
    exit 1
fi

if [ -z $2 ]; then
    echo -e "Error: target nameserver is empty. Pass nameserver as second argument.\n"
    display_help
    exit 1
fi

if [ $# -lt 2 ]; then
    echo -e "Error: too many arguments passed to script.\n"
    display_help
    exit 1
fi

domains=$(nslookup -type=ANY -query=AXFR "$1" "$2" | grep Name | cut -d ':' -f2 | sed -e 's/^[ \t]*//' -e '/^$/d')
echo "$domains"

echo "$domains" | while IFS= read -r line; do
  nslookup -type=ANY -query=AXFR "$line" "$2" | grep Name | cut -d ':' -f2 | sed -e 's/^[ \t]*//' -e '/^$/d'
done
