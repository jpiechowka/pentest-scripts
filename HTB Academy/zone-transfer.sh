#!/usr/bin/env bash

display_help()
{
    echo "Zone transfer testing script for domain enumeration."
    echo "It will perform zone transfer recursively for any subdomain found."
    echo "Usage:"
    echo -e "    $0 [TARGET] [TARGET NAMESERVER]\n"
    echo "Do not forget to edit /etc/hosts if necessary."
}

if [ -z $1 ]; then
    echo "Target is empty. Pass target as first argument."
    display_help
    exit 1
fi

if [ -z $2 ]; then
    echo "Target nameserver is empty. Pass nameserver as second argument."
    display_help
    exit 1
fi

if [ $# -lt 2 ]; then
    echo "Too many arguments passed to script."
    display_help
    exit 1
fi

echo "Target: $1"
echo -e "Target nameserver: $2\n"

domains=$(nslookup -type=ANY -query=AXFR "$1" "$2" | grep Name | cut -d ':' -f2 | sed -e 's/^[ \t]*//' -e '/^$/d')
echo "$domains"

echo "$domains" | while IFS= read -r line; do
  nslookup -type=ANY -query=AXFR "$line" "$2" | grep Name | cut -d ':' -f2 | sed -e 's/^[ \t]*//' -e '/^$/d'
done
