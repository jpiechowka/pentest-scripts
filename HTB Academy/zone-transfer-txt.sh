#!/usr/bin/env bash

display_help()
{
    echo "Script to grab TXT records for domains."
    echo "Make sure that zone-transfer.sh script is in the same directory."
    echo "Usage:"
    echo -e "    $0 [TARGET] [TARGET NAMESERVER]\n"
    echo "Do not forget to edit /etc/hosts if necessary."
}

if [ -z $1 ]; then
    echo -e "Error: target is empty. Pass target as first argument.\n"
    display_help
    exit 1
fi

if [ -z $2 ]; then
    echo -e "Error: target nameserver is empty. Pass nameserver as second argument.\n"
    display_help
    exit 1
fi

if [ $# -lt 2 ]; then
    echo -e "Error: too many arguments passed to script.\n"
    display_help
    exit 1
fi

domains=$(./zone-transfer.sh "$1" "$2")

echo "$domains" | while IFS= read -r line; do
  dig txt "$line" @"$2"
done
